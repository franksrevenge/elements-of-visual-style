<!DOCTYPE html>
<html>
<head>
	<title>Textured Triangle</title>
	
	<link rel='stylesheet' type='text/css' href='http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/themes/ui-lightness/jquery-ui.min.css' />	
	<link rel='stylesheet' type='text/css' href='http://cdnjs.cloudflare.com/ajax/libs/foundation/4.3.1/css/foundation.min.css' />
		
	<script src='http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js'></script>
	<script src='http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js'></script>
	
	<script data-main='../src/core-loader'  src='../vendor/require.js'></script>
</head>
<body>
	<div class='row'>
		<div class='twenty columnns'>
			<h1>Textured Triangle</h1>
			
			<p>Pure JavaScript implementation of textured triangle polygon (<i>not</i> Canvas path)</p>
		</div>
	</div>	

	<div class='row'>
		<div class='twenty columns'>
			<canvas id='surface' width='640' height='480' style='border: 1px solid #000000;'></canvas>
		</div>
	</div>
	
	<div class='row'>
		<button id='drawButton'>Draw</button>
	</div>
	
<script type='text/javascript'>	

	function drawTriangle( radAdjustment, posX, posY, triangle, uv )
	{
		var translatedTriangle	= [ new Point2D(), new Point2D(), new Point2D() ];
		var rad					= radAdjustment;
		
		for( var j = 0; j < 3; j++ )
		{
			translatedTriangle[ j ].x = 
					posX +
					triangle[ j ].x * Math.cos( rad ) - triangle[ j ].y * Math.sin( rad );

			translatedTriangle[ j ].y = 
					posY +
					triangle[ j ].y * Math.cos( rad ) + triangle[ j ].x * Math.sin( rad );
		}

		Draw.texturedTriangle( 
				translatedTriangle[ 0 ],
				translatedTriangle[ 1 ],
				translatedTriangle[ 2 ],
				uv[ 0 ],
				uv[ 1 ],
				uv[ 2 ],
				texture
			);
	}


	function drawAll( rad )
	{
		Draw.beginPaint();
			Draw.color.set( 32, 255, 32 );
			
			// rad = 0.76525;

			
			/* InterpolatedTriangle.draw( 
					new Point2D( 320, 100 ),
					new Point2D( 220, 300 ),
					new Point2D( 420, 300 ),
					new Color( 255, 255, 255 ),
					new Color( 255, 0, 0 ),
					new Color( 0, 0, 0 )
				); */
			
			
			/* drawTriangle( 
					rad, 160, 200,
					[ new Point2D( 0, -10 ), new Point2D( 100, 10 ), new Point2D( -10, 10 ) ],
					[ new Point3D( 1, 0, 0 ), new Point3D( 1, 1, 0 ), new Point3D( 0, 1, 0 ) ]
				); */
			


			var s = Math.cos( rad );

			//rad = 0.76525;
			//rad = 23.56;

			//rad = 44.8;
			//rad = 41.6;
			s = 1;
			
			 drawTriangle(
					rad, 320, 300,					[ new Point2D( s * 100, s * -100 ), new Point2D( s * 100, s * 100 ), new Point2D( s * -100, s * 100 ) ],
					[ new Point3D( 1, 0, 0 ), new Point3D( 1, 1, 0 ), new Point3D( 0, 1, 0 ) ]
				);


			drawTriangle(
					rad, 320, 150,
					[ new Point2D( s * 100, s * -100 ), new Point2D( s * 100, s * 100 ), new Point2D( s * -100, s * 100 ) ],
					[ new Point3D( 0.25, 0.75, 0 ), new Point3D( 0.5, 0.25, 0 ), new Point3D( 0.75, 0.75, 0 ) ]
					// [ new Point3D( 1, 0, 0 ), new Point3D( 1, 1, 0 ), new Point3D( 0, 1, 0 ) ]
			);


/*			Triangle.draw( new Point2D( 0, -100 ), new Point2D( 100, 100 ), new Point2D( -100, 100 ) );
			Triangle.draw( new Point2D( 0, 380 ), new Point2D( 100, 580 ), new Point2D( -100, 580 ) );

			Triangle.draw( new Point2D( 630, -100 ), new Point2D( 740, 100 ), new Point2D( 540, 100 ) );
			Triangle.draw( new Point2D( 630, 380 ), new Point2D( 740, 580 ), new Point2D( 540, 580 ) );

			Draw.color.set( 32, 32, 255 );
			drawTriangles( rad, 150, [ new Point2D( 0, -10 ), new Point2D( -10, 10 ), new Point2D( 10, 0 ) ] );
				drawTriangles( rad, 200, [ new Point2D( 0, -8 ), new Point2D( 7, 4 ), new Point2D( 10, 0 ) ] );
			drawTriangles( rad, 250, [ new Point2D( 0, -10 ), new Point2D( -30, 10 ), new Point2D( 30, 35 ) ] );*/
		Draw.endPaint();
	}


	var surface;
	var startTime	= new Date();
	var texture;
	
	
	
	$( document ).on(
			'EVS:CoreLoaded',
			function()
			{
				var surface		= new Surface( 'surface', false );

				Draw.setSurface( surface );
				Draw.bgColor.set( 220, 220, 220 );

				// drawAll( 0 );

				texture = new CanvasTexture( 'resources/smiley2.png' );

				texture.onload	= function()
				{
					setInterval( 
							function()
							{
								if( surface.isDrawing() === false )
								{
									var curTime	= new Date();					
									var rad		= ( curTime.getTime() - startTime.getTime() ) / 1000;

									drawAll( rad );
								}
							},
							25
						);
				}



				$( document ).on( 
						'click', 
						'#drawButton',
						function()
						{
							if( texture.loaded === true )
							{
								drawAll( 0 );
							}
						}
					);
			}
		);
	
	
	
	
</script>

</body>
</html>

