<!DOCTYPE html>
<html>
<head>
	<title>Fisheye Lens</title>
	
	<link rel='stylesheet' type='text/css' href='http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/ui-lightness/jquery-ui.min.css' />
	<link rel='stylesheet' type='text/css' href='http://cdnjs.cloudflare.com/ajax/libs/foundation/4.3.1/css/foundation.min.css' />
	
	<script src='http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js'></script>
	<script src='http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/jquery-ui.min.js'></script>
	
	<script data-main='../src/core-loader'  src='../vendor/require.js'></script>
	<script src='../src/App/FisheyeLens.js'></script>
</head>
<body>
	<div class='row'>
		<div class='twenty columnns'>
			<h1>Fisheye Lens</h1>
			
			<p>A HTML5 canvas test which implements <a href='http://en.wikipedia.org/wiki/Distortion_(optics)'>radial barrel distortion</a>.</p>
		</div>
	</div>	

	<div class='row'>
		<div class='twenty columns'>
			<canvas id='surface' width='900' height='675' style='border: 1px solid #000000;'></canvas>
		</div>
	</div>
	

	
<script type='text/javascript'>

	var flApp;
	var startTime = new Date();
	var myInterval;
	var isPaused = false;

	var lenses = [
			{
				x 			: 163,
				y			: 48,
				radius		: 250,
				dirX		: -1,
				dirY		: 0,
				speedX		: -1.6,
				speedY		: 0.0
			},
			{
				x 			: 263,
				y			: 98,
				radius		: 300,
				dirX		: 2.3,
				dirY		: 0,
				speedX		: 1,
				speedY		: 0.0
			}
	];



	$( document ).on( 
			'EVS:CoreLoaded', 
			function()
			{
				flApp = new FisheyeLens( 'surface', 'resources/bg.jpg' );

				for( var i = 0; i < lenses.length; i++ )
				{
					flApp.addLens( lenses[ i ] );
				}

				myInterval = setInterval(
						function()
						{
							moveLenses();

							if( ( flApp.isDrawing() === true ) || ( isPaused === true ) )
							{
								return;
							}

							flApp.draw();
						},
						25
					);
			}
		);


	function moveLenses()
	{
		var canvas = Helper.getElement( 'surface' );

		for( var i = 0; i < lenses.length; i++ )
		{
			lenses[ i ].x += lenses[ i ].speedX;
			lenses[ i ].y += lenses[ i ].speedY;

			lenses[ i ].speedY += 0.7;

			if( ( lenses[ i ].x + lenses[ i ].radius >= canvas.width ) && ( lenses[ i ].speedX >= 0 ) )
			{
				lenses[ i ].x		= canvas.width - lenses[ i ].radius;
				lenses[ i ].speedX = -Math.min( 8.0, Math.abs( lenses[ i ].speedX ) * ( 0.7 + Math.random() ) );
			}

			if( ( lenses[ i ].x < 0 ) && ( lenses[ i ].speedX <= 0 ) )
			{
				lenses[ i ].x = 0;
				lenses[ i ].speedX = Math.min( 8.0, Math.abs( lenses[ i ].speedX ) * ( 0.5 + Math.random() ) );
			}



			if( ( lenses[ i ].y < 0 ) && ( lenses[ i ].speedY <= 0 ) )
			{
				lenses[ i ].y = 0;
				lenses[ i ].speedY = -lenses[ i ].speedY * 0.9;
			}

			if( ( lenses[ i ].y + lenses[ i ].radius >= canvas.height ) && ( lenses[i ].speedY >= 0 ) )
			{
				lenses[ i ].y = canvas.height - lenses[ i ].radius;
				lenses[ i ].speedY = -lenses[ i ].speedY * 0.85;

				if( Math.abs( lenses[ i ].speedY ) < 8 )
				{
					lenses[ i ].speedY *= 3;
				}
			}

		}



	}


</script>

</body>
</html>