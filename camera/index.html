<!DOCTYPE html>
<html>
<head>
	<title>Camera</title>
	
	<link rel='stylesheet' type='text/css' href='http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/themes/ui-lightness/jquery-ui.min.css' />	
	<link rel='stylesheet' type='text/css' href='http://cdnjs.cloudflare.com/ajax/libs/foundation/4.3.1/css/foundation.min.css' />

	<script src='http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js'></script>
	<script src='http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js'></script>
	
	<script data-main='../src/3d-loader'  src='../vendor/require.js'></script>	
</head>
<body>
	<div class='row'>
		<div class='twenty columnns'>
			<h1>Camera</h1>
			
			<p>Pure JavaScript implementation of camera projection</p>
		</div>
	</div>	

	<div class='row'>
		<div class='twenty columns'>
			<canvas id='surface' width='640' height='480' style='border: 1px solid #000000;'></canvas>
		</div>
		
		<div id='sceneFPS' class='twenty columns'></div>
	</div>

	<div class='row'>
		<div class='twenty columns'>
			<dl class='sub-nav' id='renderer-selector'>
				<dt>Draw:</dt>

				<dd id='renderer-vertex'><a href='javascript:void(0)'>Vertex</a></dd>
				<dd id='renderer-wireframe'><a href='javascript:void(0)'>Wireframe</a></dd>
				<dd id='renderer-solid'><a href='javascript:void(0)'>Solid</a></dd>
				<dd id='renderer-flat'><a href='javascript:void(0)'>Flat</a></dd>
				<dd id='renderer-gouraud'><a href='javascript:void(0)'>Gouraud</a></dd>
				<dd id='renderer-texture'><a href='javascript:void(0)'>Texture</a></dd>
			</dl>
		</div>
	</div>


	<div class='row'>
		<div class='twenty columns'>
			<dl class='sub-nav' id='object-selector'>
				<dt>Object:</dt>

				<dd id='object-cube'><a href='javascript:void(0)'>Cube</a></dd>
				<dd id='object-sphere'><a href='javascript:void(0)'>Sphere</a></dd>
				<dd id='object-torus'><a href='javascript:void(0)'>Torus</a></dd>
				<dd id='object-teapot'><a href='javascript:void(0)'>Teapot</a></dd>
			</dl>
		</div>
	</div>


	<script type='text/javascript'>
	/**
	 * @type Surface
	 */
	var surface;
	
	/**
	 * @type Scene
	 */
	var scene;
	
	/**
	 * @type Mesh
	 */
	var torus;
	var teapot;
	var sphere;
	var cube;
	
	/**
	 * @type Renderer
	 */
	var renderer;
	
	/**
	 * @type Camera
	 */
	var camera;

	/**
	 * @
	
	/**
	 * @type Light
	 */
	var light;
	var light2;
	
	
	$( document ).on( 
			'EVS:3DLoaded', 
			function()
			{
				surface		= new Surface( 'surface', false );

				Draw.setSurface( surface );
				Draw.bgColor.set( 220, 220, 220 );
				Draw.color.set( 0, 0, 0 );


				scene		= new Scene();

				torus		= TorusFactory.generate( 500, 500, 250, 15, 9 );
				teapot		= ObjFactory.load( 'resources/objects/teapot.obj', scene );
				cube		= CuboidFactory.generate( 500, 500, 500 );
				sphere		= SphereFactory.generate( 500, 500, 500, 10 );

				torus.position.z	= -1200;
				teapot.position.z	= -1200;
				cube.position.z		= -1200;
				sphere.position.z	= -1200;

				teapot.scale.set( 800, 800, 800 );

				// mesh		= CuboidFactory.generate( 250, 250, 250 );
				
				
				camera		= new MovableCamera();
				// renderer	= new VertexRenderer();	
				// renderer	= new WireframeRenderer();	
				// renderer	= new FlatRenderer();
				// renderer	= new FlatShaderRenderer();
				// renderer	= new GouraudShaderRenderer();
				
				setRenderer( 'flat' );
				setObject( 'torus' );
				
				light				= new OmniLight( new Point3D( -250, 0, -800 ), new NormalizedColor( 1, 1, 1 ) );
				light.diffusePower	= 20000;
				
				// light2			= new OmniLight( new Point3D( +350, 0, -1000 ), new NormalizedColor( 1, 1, 1 ) );
				light2				= new OmniLight( new Point3D( 0, 0, -1200 ), new NormalizedColor( 1, 1, 1 ) );
				light2.diffusePower	= 20000;

				// scene.addMesh( torus );
				scene.addCamera( camera );
				scene.addRenderer( renderer );
				
				scene.addLight( light );
				scene.addLight( light2 );

				/* Draw.beginPaint();
					scene.render();
				Draw.endPaint(); */
	
				setInterval( 
						function()
						{
							if( surface.isDrawing() === false )
							{
								rotateMesh();
							}
						},
						25
					);

		
				$( document ).on( 
						'click', 
						'#drawButton',
						function()
						{
							drawAll( 0 );
						}
					);
			}					
		);
		
		
		
	$( '#renderer-selector dd' ).on( 
			'click',
			function( event )
			{
				var type = this.id.substr( 9 );
				
				setRenderer( type );
			}
		);

	$( '#object-selector dd' ).on(
			'click',
			function( event )
			{
				var type = this.id.substr( 7 );

				setObject( type );
			}
	);


	function rotateMesh()
	{
		torus.rotation.addByVal( 0.01 );
		teapot.rotation.addByVal( 0.01 );
		cube.rotation.addByVal( 0.01 );
		sphere.rotation.addByVal( 0.01 );

		Draw.beginPaint();
			scene.render();
		Draw.endPaint();
		
		$( '#sceneFPS' ).html( scene.renderFPS );
	}
	
	
	function setRenderer( rendererName )
	{
		if( scene === null )
		{
			return;
		}
		
		switch( rendererName )
		{
			case 'vertex':
				Draw.color = new Color( 88, 88, 255 );
				renderer = new VertexRenderer();
				break;
				
			case 'wireframe':
				Draw.color = new Color( 88, 88, 255 );
				renderer = new WireframeRenderer();
				break;
				
			case 'solid':
				renderer = new FlatRenderer();
				break;
				
			case 'flat':
				renderer = new FlatShaderRenderer();
				break;
				
			case 'gouraud':
				renderer = new GouraudShaderRenderer();
				break;

			case 'texture':
				renderer = new TextureRenderer();
				break;
		}
		
		scene.addRenderer( renderer, true );
		
		$( '#renderer-' + rendererName ).siblings().removeClass( 'active' );
		$( '#renderer-' + rendererName ).addClass( 'active' );
	}


	function setObject( objectName )
	{
		if( scene === null )
		{
			return;
		}

		scene.clearMeshes();


		switch( objectName )
		{
			case 'cube':
				scene.addMesh( cube );
				break;

			case 'sphere':
				scene.addMesh( sphere );
				break;

			case 'torus':
				scene.addMesh( torus );
				break;

			case 'teapot':
				scene.addMesh( teapot );
				break;
		}

		$( '#object-' + objectName ).siblings().removeClass( 'active' );
		$( '#object-' + objectName ).addClass( 'active' );
	}
	
</script>

</body>
</html>

